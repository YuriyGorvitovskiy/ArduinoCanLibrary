/**
 ** This is Public Domain Software.
 ** 
 ** The author disclaims copyright to this source code.  
 ** In place of a legal notice, here is a blessing:
 **
 **    May you do good and not evil.
 **    May you find forgiveness for yourself and forgive others.
 **    May you share freely, never taking more than you give.
 **/
 
#ifndef __MCP2515_H__
#define __MCP2515_H__

// SPI Commands for MCP2515
#define MCP2515_SPI_INSTR_RESET                      (B11000000)
#define MCP2515_SPI_INSTR_READ                       (B00000011)
#define MCP2515_SPI_INSTR_READ_RX(BUFFER, POSITION)  (B10010000|(BUFFER<<2)|(POSITION<<1))
#define MCP2515_SPI_INSTR_WRITE                      (B00000010)
#define MCP2515_SPI_INSTR_WRITE_TX(BUFFER, POSITION) (B01000000|(BUFFER<<1)|POSITION)
#define MCP2515_SPI_INSTR_MODIFY                     (B00000101)
#define MCP2515_SPI_INSTR_STATUS                     (B10100000)
#define MCP2515_SPI_INSTR_RX_STATUS                  (B10110000)
#define MCP2515_SPI_INSTR_RTS_SINGLE(BUFFER)         (B10000000|(1<<BUFFER))
#define MCP2515_SPI_INSTR_RTS_SET(BUFFERS)           (B10000000|BUFFER)

// MCP2515 addresses
#define MCP2515_ADDR_RXF0      (0x00)
#define MCP2515_ADDR_RXF0SIDH  (0x00)
#define MCP2515_ADDR_RXF0SIDL  (0x01)
#define MCP2515_ADDR_RXF0EIDH  (0x02)
#define MCP2515_ADDR_RXF0EIDL  (0x03)

#define MCP2515_ADDR_RXF1      (0x04)
#define MCP2515_ADDR_RXF1SIDH  (0x04)
#define MCP2515_ADDR_RXF1SIDL  (0x05)
#define MCP2515_ADDR_RXF1EIDH  (0x06)
#define MCP2515_ADDR_RXF1EIDL  (0x07)

#define MCP2515_ADDR_RXF2      (0x08)
#define MCP2515_ADDR_RXF2SIDH  (0x08)
#define MCP2515_ADDR_RXF2SIDL  (0x09)
#define MCP2515_ADDR_RXF2EIDH  (0x0A)
#define MCP2515_ADDR_RXF2EIDL  (0x0B)

#define MCP2515_ADDR_RXF3      (0x10)
#define MCP2515_ADDR_RXF3SIDH  (0x10)
#define MCP2515_ADDR_RXF3SIDL  (0x11)
#define MCP2515_ADDR_RXF3EIDH  (0x12)
#define MCP2515_ADDR_RXF3EIDL  (0x13)

#define MCP2515_ADDR_RXF4      (0x14)
#define MCP2515_ADDR_RXF4SIDH  (0x14)
#define MCP2515_ADDR_RXF4SIDL  (0x15)
#define MCP2515_ADDR_RXF4EIDH  (0x16)
#define MCP2515_ADDR_RXF4EIDL  (0x17)

#define MCP2515_ADDR_RXF5      (0x18)
#define MCP2515_ADDR_RXF5SIDH  (0x18)
#define MCP2515_ADDR_RXF5SIDL  (0x19)
#define MCP2515_ADDR_RXF5EIDH  (0x1A)
#define MCP2515_ADDR_RXF5EIDL  (0x1B)

#define MCP2515_ADDR_RXM0      (0x20)
#define MCP2515_ADDR_RXM0SIDH  (0x20)
#define MCP2515_ADDR_RXM0SIDL  (0x21)
#define MCP2515_ADDR_RXM0EIDH  (0x22)
#define MCP2515_ADDR_RXM0EIDL  (0x23)

#define MCP2515_ADDR_RXM1      (0x24)
#define MCP2515_ADDR_RXM1SIDH  (0x24)
#define MCP2515_ADDR_RXM1SIDL  (0x25)
#define MCP2515_ADDR_RXM1EIDH  (0x26)
#define MCP2515_ADDR_RXM1EIDL  (0x27)

#define MCP2515_ADDR_BFPCTRL   (0x0C)
#define MCP2515_ADDR_TXRTSCTRL (0x0D)
#define MCP2515_ADDR_CANSTAT   (0x0E)
#define MCP2515_ADDR_CANCTRL   (0x0F)

#define MCP2515_ADDR_TEC       (0x1C)
#define MCP2515_ADDR_REC       (0x1D)

#define MCP2515_ADDR_CNF3      (0x28)
#define MCP2515_ADDR_CNF2      (0x29)
#define MCP2515_ADDR_CNF1      (0x2A)
#define MCP2515_ADDR_CANINTE   (0x2B)
#define MCP2515_ADDR_CANINTF   (0x2C)
#define MCP2515_ADDR_EFLG      (0x2D)

#define MCP2515_ADDR_TXB0CTRL  (0x30)
#define MCP2515_ADDR_TXB1CTRL  (0x40)
#define MCP2515_ADDR_TXB2CTRL  (0x50)
#define MCP2515_ADDR_RXB0CTRL  (0x60)
#define MCP2515_ADDR_RXB1CTRL  (0x70)

// MCP2515 constant to setup values in corresponding addresses
#define MCP2515_CNF1_BRP(n)           (n)
#define MCP2515_CNF1_SJW(n)           ((n-1)<<6)

#define MCP2515_CNF2_BTLMODE_BY_CNF3  (B10000000)
#define MCP2515_CNF2_BTLMODE_AUTO     (B00000000)
#define MCP2515_CNF2_SAM_3TIMES       (B01000000)
#define MCP2515_CNF2_SAM_1TIME        (B00000000)
#define MCP2515_CNF2_PHSEG1(n)        ((n-1)<<3)
#define MCP2515_CNF2_PRSEG(n)         (n-1)

#define MCP2515_CNF3_CLKOUT_PIN_SOF      (B10000000)
#define MCP2515_CNF3_CLKOUT_PIN_CLOCKOUT (B00000000)
#define MCP2515_CNF3_WAKEUP_ON           (B01000000)
#define MCP2515_CNF3_WAKEUP_OFF          (B00000000)
#define MCP2515_CNF3_PHSEG2(n)           (n-1)

#define MCP2515_CANINTE_MERRE_ON         (B10000000)
#define MCP2515_CANINTE_MERRE_OFF        (B00000000)
#define MCP2515_CANINTE_WAKIE_ON         (B01000000)
#define MCP2515_CANINTE_WAKIE_OFF        (B00000000)
#define MCP2515_CANINTE_ERRIE_ON         (B00100000)
#define MCP2515_CANINTE_ERRIE_OFF        (B00000000)
#define MCP2515_CANINTE_TX2IE_ON         (B00010000)
#define MCP2515_CANINTE_TX2IE_OFF        (B00000000)
#define MCP2515_CANINTE_TX1IE_ON         (B00001000)
#define MCP2515_CANINTE_TX1IE_OFF        (B00000000)
#define MCP2515_CANINTE_TX0IE_ON         (B00000100)
#define MCP2515_CANINTE_TX0IE_OFF        (B00000000)
#define MCP2515_CANINTE_RX1IE_ON         (B00000010)
#define MCP2515_CANINTE_RX1IE_OFF        (B00000000)
#define MCP2515_CANINTE_RX0IE_ON         (B00000001)
#define MCP2515_CANINTE_RX0IE_OFF        (B00000000)

#define MCP2515_CANINTF_MERRF           (B10000000)
#define MCP2515_CANINTF_WAKIF           (B01000000)
#define MCP2515_CANINTF_ERRIF           (B00100000)
#define MCP2515_CANINTF_TX2IF           (B00010000)
#define MCP2515_CANINTF_TX1IF           (B00001000)
#define MCP2515_CANINTF_TX0IF           (B00000100)
#define MCP2515_CANINTF_RX1IF           (B00000010)
#define MCP2515_CANINTF_RX0IF           (B00000001)

#define MCP2515_CANCTRL_REQOP_MASK      (B11100000)            
#define MCP2515_CANCTRL_REQOP_NORMAL    (B00000000)            
#define MCP2515_CANCTRL_REQOP_SLEEP     (B00100000)            
#define MCP2515_CANCTRL_REQOP_LOOPBACK  (B01000000)            
#define MCP2515_CANCTRL_REQOP_LISTEN    (B01100000)            
#define MCP2515_CANCTRL_REQOP_CONFIG    (B10000000)            

#define MCP2515_CANCTRL_ABORT_MASK      (B00010000)            
#define MCP2515_CANCTRL_ABORT_TX        (B00010000)            
#define MCP2515_CANCTRL_ABORT_CANCEL    (B00000000)            

#define MCP2515_CANCTRL_OSM_MASK        (B00001000)            
#define MCP2515_CANCTRL_OSM_ON          (B00001000)            
#define MCP2515_CANCTRL_OSM_OFF         (B00000000)            

#define MCP2515_CANCTRL_CLKEN_MASK      (B00000100)            
#define MCP2515_CANCTRL_CLKEN_ON        (B00000100)            
#define MCP2515_CANCTRL_CLKEN_OFF       (B00000000)            

#define MCP2515_CANCTRL_CLKPRE_MASK     (B00000011)
#define MCP2515_CANCTRL_CLKPRE_1        (B00000000)
#define MCP2515_CANCTRL_CLKPRE_2        (B00000001)
#define MCP2515_CANCTRL_CLKPRE_4        (B00000010)
#define MCP2515_CANCTRL_CLKPRE_8        (B00000011)

#define MCP2515_CANSTAT_OPMOD_MASK      (B11100000)
#define MCP2515_CANSTAT_OPMOD_NORMAL    (B00000000)
#define MCP2515_CANSTAT_OPMOD_SLEEP     (B00100000)            
#define MCP2515_CANSTAT_OPMOD_LOOPBACK  (B01000000)            
#define MCP2515_CANSTAT_OPMOD_LISTEN    (B01100000)            
#define MCP2515_CANSTAT_OPMOD_CONFIG    (B10000000)            

#define MCP2515_CANSTAT_ICOD_MASK      (B00001110)
#define MCP2515_CANSTAT_ICOD_NONE      (B00000000)
#define MCP2515_CANSTAT_ICOD_ERROR     (B00000010)
#define MCP2515_CANSTAT_ICOD_WAKEUP    (B00000100)
#define MCP2515_CANSTAT_ICOD_TXB0      (B00000110)
#define MCP2515_CANSTAT_ICOD_TXB1      (B00001000)
#define MCP2515_CANSTAT_ICOD_TXB2      (B00001010)
#define MCP2515_CANSTAT_ICOD_RXB0      (B00001100)
#define MCP2515_CANSTAT_ICOD_RXB1      (B00001110)

#define MCP2515_EFLG_RX1OVR            (B10000000)
#define MCP2515_EFLG_RX0OVR            (B01000000)
#define MCP2515_EFLG_TXBO              (B00100000)
#define MCP2515_EFLG_TXEP              (B00010000)
#define MCP2515_EFLG_RXEP              (B00001000)
#define MCP2515_EFLG_TXWAR             (B00000100)
#define MCP2515_EFLG_RXWAR             (B00000010)
#define MCP2515_EFLG_EWARN             (B00000001)

#define MCP2515_TXRTSCTRL_B2RTS_PIN    (B00100000)
#define MCP2515_TXRTSCTRL_B2RTS_ZERO   (B00000000)
#define MCP2515_TXRTSCTRL_B1RTS_PIN    (B00010000)
#define MCP2515_TXRTSCTRL_B1RTS_ZERO   (B00000000)
#define MCP2515_TXRTSCTRL_B0RTS_PIN    (B00001000)
#define MCP2515_TXRTSCTRL_B0RTS_ZERO   (B00000000)
#define MCP2515_TXRTSCTRL_B2RTSM_PIN   (B00000100)
#define MCP2515_TXRTSCTRL_B2RTSM_DIM   (B00000000)
#define MCP2515_TXRTSCTRL_B1RTSM_PIN   (B00000010)
#define MCP2515_TXRTSCTRL_B1RTSM_DIM   (B00000000)
#define MCP2515_TXRTSCTRL_B0RTSM_PIN   (B00000001)
#define MCP2515_TXRTSCTRL_B0RTSM_DIM   (B00000000)

#define MCP2515_BFPCTRL_B1BFS_PIN      (B00100000)
#define MCP2515_BFPCTRL_B1BFS_ZERO     (B00000000)
#define MCP2515_BFPCTRL_B0BFS_PIN      (B00010000)
#define MCP2515_BFPCTRL_B0BFS_ZERO     (B00000000)
#define MCP2515_BFPCTRL_B1BFE_PIN_ON   (B00001000)
#define MCP2515_BFPCTRL_B1BFE_PIN_OFF  (B00000000)
#define MCP2515_BFPCTRL_B0BFE_PIN_ON   (B00000100)
#define MCP2515_BFPCTRL_B0BFE_PIN_OFF  (B00000000)
#define MCP2515_BFPCTRL_B1BFM_PIN      (B00000010)
#define MCP2515_BFPCTRL_B1BFM_DOM      (B00000000)
#define MCP2515_BFPCTRL_B0BFM_PIN      (B00000001)
#define MCP2515_BFPCTRL_B0BFM_DOM      (B00000000)

#define MCP2515_TXBCTRL_ABTF            (B01000000)
#define MCP2515_TXBCTRL_MLOA            (B00100000)
#define MCP2515_TXBCTRL_TXERR           (B00010000)
#define MCP2515_TXBCTRL_TXREQ           (B00001000)
#define MCP2515_TXBCTRL_TXP             (B00000011)

#define MCP2515_RXB0CTRL_RXM_MASK       (B01100000)
#define MCP2515_RXB0CTRL_RXM_ALL_FILTER (B00000000)
#define MCP2515_RXB0CTRL_RXM_STD_FILTER (B00100000)
#define MCP2515_RXB0CTRL_RXM_EXT_FILTER (B01000000)
#define MCP2515_RXB0CTRL_RXM_ALL        (B01100000)
#define MCP2515_RXB0CTRL_RXRTR          (B00001000)
#define MCP2515_RXB0CTRL_BUKT_MASK      (B00000100)
#define MCP2515_RXB0CTRL_BUKT_ON        (B00000100)
#define MCP2515_RXB0CTRL_BUKT_OFF       (B00000010)
#define MCP2515_RXB0CTRL_FILHIT_MASK    (B00000001)
#define MCP2515_RXB0CTRL_FILHIT_RXF0    (B00000000)
#define MCP2515_RXB0CTRL_FILHIT_RXF1    (B00000001)

#define MCP2515_RXB1CTRL_RXM_MASK       (B01100000)
#define MCP2515_RXB1CTRL_RXM_ALL_FILTER (B00000000)
#define MCP2515_RXB1CTRL_RXM_STD_FILTER (B00100000)
#define MCP2515_RXB1CTRL_RXM_EXT_FILTER (B01000000)
#define MCP2515_RXB1CTRL_RXM_ALL        (B01100000)
#define MCP2515_RXB1CTRL_RXRTR          (B00001000)
#define MCP2515_RXB1CTRL_FILHIT_MASK    (B00000111)
#define MCP2515_RXB1CTRL_FILHIT_RXF0    (B00000000)
#define MCP2515_RXB1CTRL_FILHIT_RXF1    (B00000001)
#define MCP2515_RXB1CTRL_FILHIT_RXF2    (B00000010)
#define MCP2515_RXB1CTRL_FILHIT_RXF3    (B00000011)
#define MCP2515_RXB1CTRL_FILHIT_RXF4    (B00000100)
#define MCP2515_RXB1CTRL_FILHIT_RXF5    (B00000101)

#define MCP2515_STATUS_RX0IF			(B00000001)
#define MCP2515_STATUS_RX1IF			(B00000010)
#define MCP2515_STATUS_TX0REQ			(B00000100)
#define MCP2515_STATUS_TX0IF			(B00001000)
#define MCP2515_STATUS_TX1REQ			(B00010000)
#define MCP2515_STATUS_TX1IF			(B00100000)
#define MCP2515_STATUS_TX2REQ			(B01000000)
#define MCP2515_STATUS_TX2IF			(B10000000)

#define MCP2515_RX_STATUS_RXB_MASK      (B11000000)
#define MCP2515_RX_STATUS_RXB1          (B10000000)
#define MCP2515_RX_STATUS_RXB0          (B01000000)
#define MCP2515_RX_STATUS_STD           (B00000000)
#define MCP2515_RX_STATUS_EXT           (B00010000)
#define MCP2515_RX_STATUS_RTR           (B00001000)
#define MCP2515_RX_STATUS_FILTER_MASK   (B00000111)
#define MCP2515_RX_STATUS_FILTER0       (B00000000)
#define MCP2515_RX_STATUS_FILTER1       (B00000001)
#define MCP2515_RX_STATUS_FILTER2       (B00000010)
#define MCP2515_RX_STATUS_FILTER3       (B00000011)
#define MCP2515_RX_STATUS_FILTER4       (B00000100)
#define MCP2515_RX_STATUS_FILTER5       (B00000101)
#define MCP2515_RX_STATUS_FILTER_RO0    (B00000110)
#define MCP2515_RX_STATUS_FILTER_RO1    (B00000111)

#define MCP2515_RXBSIDH_INDEX			(0)
#define MCP2515_RXBSIDH_SID_MASK		(B11111111)
#define MCP2515_RXBSIDH_SID_LSHIFT		(3)

#define MCP2515_RXBSIDL_INDEX			(1)
#define MCP2515_RXBSIDL_SID_MASK		(B11100000)
#define MCP2515_RXBSIDL_SID_RSHIFT		(5)
#define MCP2515_RXBSIDL_SRR				(B00010000)
#define MCP2515_RXBSIDL_IDE				(B00001000)
#define MCP2515_RXBSIDL_EID_MASK		(B00000011)
#define MCP2515_RXBSIDL_EID_LSHIFT		(16)

#define MCP2515_RXBEID8_INDEX			(2)
#define MCP2515_RXBEID8_EID_MASK		(B11111111)
#define MCP2515_RXBEID8_EID_LSHIFT		(8)

#define MCP2515_RXBEID0_INDEX			(3)
#define MCP2515_RXBEID0_EID_MASK		(B11111111)
#define MCP2515_RXBEID0_EID_LSHIFT		(0)

#define MCP2515_RXBDLC_INDEX			(4)
#define MCP2515_RXBDLC_RTR				(B01000000)
#define MCP2515_RXBDLC_DLC				(B00001111)

#define MCP2515_RXBDM_INDEX				(5)

#define MCP2515_TXBSIDH_INDEX			(0)
#define MCP2515_TXBSIDH_SID_MASK		(B11111111)
#define MCP2515_TXBSIDH_SID_RSHIFT		(3)

#define MCP2515_TXBSIDL_INDEX			(1)
#define MCP2515_TXBSIDL_SID_MASK		(B11100000)
#define MCP2515_TXBSIDL_SID_LSHIFT		(5)
#define MCP2515_TXBSIDL_IDE				(B00001000)
#define MCP2515_TXBSIDL_EID_MASK		(B00000011)
#define MCP2515_TXBSIDL_EID_RSHIFT		(16)

#define MCP2515_TXBEID8_INDEX			(2)
#define MCP2515_TXBEID8_EID_MASK		(B11111111)
#define MCP2515_TXBEID8_EID_RSHIFT		(8)

#define MCP2515_TXBEID0_INDEX			(3)
#define MCP2515_TXBEID0_EID_MASK		(B11111111)
#define MCP2515_TXBEID0_EID_RSHIFT		(0)

#define MCP2515_TXBDLC_INDEX			(4)
#define MCP2515_TXBDLC_RTR				(B01000000)
#define MCP2515_TXBDLC_DLC				(B00001111)

#define MCP2515_TXBDM_INDEX				(5)

#endif //__MCP2515_H__